---
title: 강의10
category: fullstack-class
---

# 11.19

 * 1-1. 아래와 같이 출력되도록 코딩하세요.    
    ㄱ. 각 부서별 정렬 및 부서 소속 사원수 출력
   ㄴ. 각 부서별 소속된 사원 정보 출력
      ( 조건: sal 많이 받는 순으로 정렬해서 번호 붙여서 출력 )

  [실행 결과]

```
deptno(dname) 
10(ACCOUNTING) - 3명
  등수  empno   ename   sal
	1	7698	BLAKE	2850.0
    2	7499	ALLEN	1600.0
    3	7844	TURNER	1500.0
20(RESEARCH) - 3명 
	1	7698	BLAKE	2850.0
    2	7499	ALLEN	1600.0
    3	7844	TURNER	1500.0
30(SALES) - 6명
    1	7698	BLAKE	2850.0
    2	7499	ALLEN	1600.0
    3	7844	TURNER	1500.0
    4	7521	WARD	1250.0
    4	7654	MARTIN	1250.0
    6	7900	JAMES	950.0
40(OPERATIONS) - 0명
     사원이 존재하지 않습니다.
```



---

**[MVC 패턴]**

다음주 월요일 HTML 수업

CSS 수업 12월 1일 ~ 3일. 자바스크립트와 JQuery 를 함께 한다.



12월 6일, 13일 주 JSP

복습과 프로젝트 선정

마지막주 (20~24) DB 모델링

27일부터 순수 코딩

모델 - 뷰 - 컨트롤러

1. tbl_cstvsboard / seq_
2. BoardDTO
3. SQL Developer. DAO 질의/응답 오라클 ->BoardDAOImpl. SELECT(), INSERT() 단위테스트
4. JUnit 단위 테스트 모듈 (라이브러리)
5. BoardService 글쓰기 -> 로그기록/암호화/트랜잭션 처리
   - BoardDAOImpl INSERT (BoardDTO dto)

네이버 지식백과: https://terms.naver.com/entry.naver?docId=5714708&cid=42346&categoryId=42346



MVC 패턴에서 controller 는 중간역할이라 try-catch 하지 않는다.

**주입**

```java
Connection conn = DBConn.getConnection();
BoardDAO boardDao = new BoardDAOImpl(conn);
BoardService service = new BoardService(boardDao );
BoardController boardController = new BoardController(service );
```



**[녹화본]**

BoardService 생성

```java
```



BoardServiceTest 생성

```java
public class BoardServiceTest {
	
	@Test
	public void insertServiceTest() {
		Connection conn = DBConn.getConnection();
		BoardDAO dao = new BoardDAOImpl(conn); // conn DI
		BoardService boardService = new BoardService(dao); // dao DI
		
		// BoardController [게시글 입력 화면 -> BoardDTO dto]
		BoardDTO dto = new BoardDTO();
		dto.setWriter("홍길동");
		dto.setPwd("1234");
		dto.setEmail("hong@naver.com");
		dto.setTitle("두 번째 게시글");
		dto.setTag(0);
		dto.setContent("게시글 추가 내용...");
		
		int rowCount = boardService.insertService(dto);
		
		if (rowCount == 1) {
			System.out.println("> 서비스 -> DAO -> INSERT 성공!!!");
		}
	}
	
	@Test
	public void selectServiceTest() {
		Connection conn = DBConn.getConnection();
		BoardDAO dao = new BoardDAOImpl(conn);
		BoardService boardService = new BoardService(dao);
		
		ArrayList<BoardDTO> list = boardService.selectService();
		
		if (list == null) {
			System.out.println("> 게시글이 존재하지 않습니다.");
		} else {
			Iterator<BoardDTO> ir = list.iterator();
			
			while (ir.hasNext()) {
				BoardDTO boardDTO = ir.next();
				System.out.println(boardDTO);
			}
		}
	}
}
```



days03.board.BoardDAOImpl

```java
public class BoardDAOImpl implements BoardDAO {
	private Connection conn = null;
	private PreparedStatement pstmt = null;
	private ResultSet rs = null;

	// ������
	public BoardDAOImpl() {
	}

	// Connection ��ü�� �����ڸ� ���ؼ� ����. - �����ڸ� ���� ������ ���� (DI: Dependency Injection)
	public BoardDAOImpl(Connection conn) {
		this.conn = conn;
	}

	@Override
	public ArrayList<BoardDTO> select() throws SQLException {
		String sql = "SELECT seq, writer, pwd, email, title, writedate, readed, tag, content " + "FROM tbl_cstvsboard " + "ORDER BY seq DESC";

		pstmt = conn.prepareStatement(sql);
		rs = pstmt.executeQuery();
		ArrayList<BoardDTO> list = null;
		BoardDTO dto;
		int seq, readed, tag;
		String writer, pwd, email, title;
		Date writedate;
		String content;

		if (rs.next()) {
			list = new ArrayList<>();

			do {
				seq = rs.getInt("seq");
				writer = rs.getString("writer");
				pwd = rs.getString("pwd");
				email = rs.getString("email");
				title = rs.getString("title");
				writedate = rs.getDate("writedate");
				readed = rs.getInt("readed");
				tag = rs.getInt("tag");
				content = rs.getString("content");

				dto = new BoardDTO(seq, writer, pwd, email, title, writedate, readed, tag, content);
				list.add(dto);

			} while (rs.next());
		}
		rs.close();
		pstmt.close();

		return list;
	}

	@Override
	public int insert(BoardDTO dto) throws SQLException {
		String sql = "INSERT INTO tbl_cstvsboard (seq, writer, pwd, email, title, tag, content) "
				+ "VALUES (seq_tbl_cstvsBoard.NEXTVAL, ?, ?, ?, ?, ?, ?)";

		pstmt = conn.prepareStatement(sql);
		pstmt.setString(1, dto.getWriter());
		pstmt.setString(2, dto.getPwd());
		pstmt.setString(3, dto.getEmail());
		pstmt.setString(4, dto.getTitle());
		pstmt.setInt(5, dto.getTag());
		pstmt.setString(6, dto.getContent());

		int rowCount = pstmt.executeUpdate();

		return rowCount;
	}

	@Override
	public void increaseReaded(int seq) throws SQLException {
		String sql = "UPDATE TBL_CSTVSBOARD " + "SET readed = readed + 1 " + "WHERE seq = ? ";
		pstmt = conn.prepareStatement(sql);
		pstmt.setInt(1, seq);
		pstmt.executeUpdate();
		pstmt.close();

	}

	@Override
	public BoardDTO view(int seq) throws SQLException {
		String sql = "SELECT seq, writer, title, content, readed, writedate " + " FROM TBL_CSTVSBOARD "
				+ " WHERE seq = ?";
		pstmt = conn.prepareStatement(sql);
		pstmt.setInt(1, seq);
		ResultSet rs = pstmt.executeQuery();

		BoardDTO dto = null;

		if (rs.next()) {
			dto = new BoardDTO();
			dto.setSeq(rs.getInt("seq"));
			dto.setWriter(rs.getString("writer"));
			dto.setTitle(rs.getString("title"));
			dto.setContent(rs.getString("content"));
			dto.setReaded(rs.getInt("readed"));
			dto.setWritedate(rs.getDate("writedate"));
		}

		rs.close();
		pstmt.close();

		return dto;
	}

	@Override
	public int delete(String seq) throws SQLException {
		int rowCount = 0;
		String sql = "DELETE FROM TBL_CSTVSBOARD "
				+ "WHERE seq = ?";
		pstmt = conn.prepareStatement(sql);
		pstmt.setString(1, seq);
		rowCount = pstmt.executeUpdate();
		
		return rowCount;
	}
}
```

BoardDAOImplTest

```java
public class BoardDAOImplTest {

	@Test
	public void select_test() {
		Connection conn = DBConn.getConnection();
		BoardDAOImpl dao = new BoardDAOImpl(conn);
		
		try {			
			ArrayList<BoardDTO> list = dao.select();
			
			if (list == null) {
				System.out.println("> 게시글이 존재하지 않습니다.");
			} else {
				Iterator<BoardDTO> ir = list.iterator();
				
				while (ir.hasNext()) {
					BoardDTO boardDTO = ir.next();
					System.out.println(boardDTO);
				}
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
	}
}
```

BoardController 생성

```java
public class BoardController {
	private BoardService boardService = null;
	private Scanner scanner = null;
	private int selectedNumber;

	public BoardController() {
		scanner = new Scanner(System.in);
	}

	public BoardController(BoardService service) {
		this();
		this.boardService = service;
	}

	public void start() {
		while (true) {
			메뉴출력();
			메뉴선택();
			메뉴처리();
		}
	}
	
	private void 메뉴처리() {
		switch (selectedNumber) {
		case 1: // 새글
			break;
		case 2: // 목록
			break;
		case 3: // 보기
			break;
		case 4: // 수정
			break;
		case 5: // 삭제
			break;
		case 6: // 검색
			break;
		case 7: // 종료
			exit();
			break;
		default:
			break;
		}
	}
	
	private void exit() {
		DBConn.close();
		System.out.println("\t\t\t 프로그램 종료!!!");
		System.exit(-1);
	}

	private void 일시정지() {
		System.out.println(" \t\t 계속하려면 엔터치세요.");
		
		try {
			System.in.read();
			System.in.skip(System.in.available()); // 13, 10
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	private void 메뉴선택() {
		System.out.print("> 메뉴 선택하세요 ? ");
		selectedNumber = scanner.nextInt();
	}
	
	private void 메뉴출력() {
		String[] menus = {
				"새글", "목록", "보기", "수정", "삭제", "검색", "종료"
		};
		System.out.println("[ 메뉴 ]");
		
		for (int i = 0; i < menus.length; i++) {
			System.out.printf("%d. %s\t", i + 1, menus[i]);
		}
		System.out.println();
	}
}
```

days04.Ex02

```java
public class Ex02 {
	public static void main(String[] args) {
		Connection conn = DBConn.getConnection();
		BoardDAO boardDao = new BoardDAOImpl(conn);
		BoardService service = new BoardService(boardDao );
		BoardController boardController = new BoardController(service );
		
		boardController.start();
	}
}
```



**새글**

```
[ 메뉴 ]
1. 새글	2. 목록	3. 보기	4. 수정	5. 삭제	6. 검색	7. 종료	
> 메뉴 선택하세요 ? 1
> wrtier, pwd, email, title, tag, content 입력 ? 라이언,1111,lion@naver.com,이거어떻게하나요?,0,이클립스에서에러가났는데...
> 게시글 글쓰기 -> 로그 기록 작업...
> 게시글 글쓰기 -> 작성자의 포인트 1증가 작업...
> 새글 쓰기 완료!!!
 		 계속하려면 엔터치세요.
```

**목록**

```
[ 메뉴 ]
1. 새글	2. 목록	3. 보기	4. 수정	5. 삭제	6. 검색	7. 종료	
> 메뉴 선택하세요 ? 2
> 게시글 목록 조회 -> 로그 기록 작업...
			 게시판
-----------------------------------------------------------
글번호	글제목                                     	글쓴이	작성일       	조회수
-----------------------------------------------------------
7	이거어떻게하나요?                      라이언	2021-11-21	0
6	경록게시글                          문경록	2021-11-21	1
5	두 번째 게시글                       홍길동	2021-11-21	0
4	두 번째 게시글                       홍길동	2021-11-21	0
3	ù ��° �Խñ�                     ȫ�浿	2021-11-21	0
2	첫 번째 게시글                       홍길동	2021-11-19	0
1	첫 번째 게시글                       홍길동	2021-11-18	0
-----------------------------------------------------------
			 [1] 2 3 4 5 6 7 8 9 10 >
-----------------------------------------------------------
 		 계속하려면 엔터치세요.
```



**보기**

```
[ 메뉴 ]
1. 새글	2. 목록	3. 보기	4. 수정	5. 삭제	6. 검색	7. 종료	
> 메뉴 선택하세요 ? 3
> 게시글 번호(seq) 입력 ? 6
> 게시글 상세보기 -> 로그 기록 작업...
ㄱ. 글번호 : 6
ㄴ. 작성자 : 문경록
ㄷ. 조회수 : 1
ㄹ. 글제목 : 경록게시글
ㅁ. 글내용 : 경록게시글내용
ㅂ. 작성일 : 2021-11-21

 [수정] [삭제] [목록]
 		 계속하려면 엔터치세요.
[ 메뉴 ]
```

**[삭제]**

```
[ 메뉴 ]
1. 새글	2. 목록	3. 보기	4. 수정	5. 삭제	6. 검색	7. 종료	
> 메뉴 선택하세요 ? 5
> 삭제할 게시글의 번호 (seq) 입력 ? 3
> 게시글 삭제 -> 로그 기록 작업...
> (3) 삭제 완료!!!
 		 계속하려면 엔터치세요.
```

**Controller**

```java
private void 삭제하기() {

    // 검색 후 삭제할 글번호 (seq) 입력 ? 
    System.out.print("> 삭제할 게시글의 번호 (seq) 입력 ? "); // 1, 2, 3
    String seq = scanner.next();

    int rowCount = boardService.deleteService(seq);

    if (rowCount >= 1) {
        System.out.printf("> (%s) 삭제 완료!!!\n", seq);
    }
    일시정지();
}
```

**Service**

```java
public int deleteService(String seq) {
    int rowCount = 0;

    // 1. 로그 기록
    System.out.println("> 게시글 삭제 -> 로그 기록 작업...");

    // 2. DB DELETE
    BoardDTO dto = null;

    try {
        rowCount = boardDao.delete(seq);

    } catch (SQLException e) {
        e.printStackTrace();
    }
    return rowCount;
}
```

**DAOImpl**

```java
@Override
public int delete(String seq) throws SQLException {
    int rowCount = 0;
    String sql = "DELETE FROM TBL_CSTVSBOARD "
        + "WHERE seq = ?";

    pstmt = conn.prepareStatement(sql);
    pstmt.setString(1, seq);
    rowCount = pstmt.executeUpdate();

    return rowCount;
}
```



**DAO**

```java
public interface BoardDAO {
	
	// 1. 모든 게시글 목록 반환하는 메서드 선언
	ArrayList<BoardDTO> select() throws SQLException;

	// 2. 새로운 게시글 추가하는 메서드 선언
	int insert(BoardDTO dto) throws SQLException;

	// 3-1. 조회수 증가 메서드 선언
	void increaseReaded(int seq) throws SQLException;
	
	// 3-2. 해당 게시글 상세 보기 메서드 선언
	BoardDTO view(int seq) throws SQLException;

	// 4. 해당 게시글 삭제 메서드 선언
	int delete(String seq) throws SQLException;
}
```

