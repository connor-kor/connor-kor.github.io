---
atitle: 강의29
category: fullstack-class
---

# 1.26

- 페이지 집중화 (모듈화): 유지, 보수, 확장성 ~ 
- inc 폴더 + jsp 모듈화
- tiles.jar 다운받아서 lib 폴더 10개
- [xml] 타일즈 관련 빈 등록: viewResolver 2개 + tiles-defs.xml
- tiles-defs.xml





문제) STSMVC 2 프로젝트 생성

- 스프링 버전 4.0.4 수정
- jre 1.6 -> 1.8
- home.jsp 브라우저 출력
- hello world 
- 시간



1. STS3 = 1. spring lagacy project
   - spring boot project
   - STS 3.9.13 (Eclipse 2020-06 (4.16.0))
   - STS4 = 2. spring boot project
2. STSMVC02 프로젝트 생성
3. 메이븐 (maven) / 그래들 (gradle)
   - 빌드도구
   - 빌드 ? 컴파일 + 실행
   - 프로젝트 생성부터 배포에 관련된 전 과정을 통합하여 관리할 수 있는 도구 (툴)
   - 프로젝트 전 과정
     1. 프로젝트 생성     eclipse + 메이븐 plugin /   sts 
     2. 라이브러리 설정                 lib 폴더  /  pom.xml
     3. 코딩 (개발) 작업
     4. 컴파일 (.class)
     5. 테스트   junit 단위 테스트
     6. 패키지 생성
     7. 인스톨
     8. 배포 Git (형사완리도구)
4. 메이븐 다운로드 + 설치 설정
   - http://maven.apache.org
   - M2_HOME 환경설정: `C:\apache-maven-3.8.4` 
   - path 환경설정 `%M2_HOME%bin` 
5. mvn.exe 메이븐 프로젝트 생성
   - +++ java Project +++
   - web Project



**[메이븐 설치]**

http://maven.apache.org

Download - Files - Binary zip archive 의 Link 다운로드

`tar.gz` 리눅스용이다.

압축풀어서 C 드라이브에 apache-maven-3.8.4 폴더 붙여넣는다.



![image-20220126103714667](../../../assets/images/image-20220126103714667.png)

환경변수를 설정 후 cmd 를 껐다켜서 mvn -version 으로 확인한다.



**archetype**

- `quickstart` java project
- `webapp` jsp project

**cmd**

```
C:\class\MvnClass>
```

```
mvn archetype:generate -DgroupId=com.newlecture -DartifactId=javaprj -DarchetypeArtifactId=maven-archetype-quickstart
```

자바프로젝트를 생성하는 명령어이다.

중간에 두 번 멈추는데 엔터를 두번 입력하면 

BUILD SUCCESS 의 초록색 글자를 볼 수 있다.

`javaprj` 폴더가 생긴다.

**cmd**

```
C:\class\MvnClass\javaprj>
```

```
mvn compile
```

컴파일 후 target 폴더가 생긴다.



**[단위 테스트]**

![image-20220126111228204](../../../assets/images/image-20220126111228204.png)

**cmd**

```
mvn test
```



(6) 패키지 생성

![image-20220126111348349](../../../assets/images/image-20220126111348349.png)

```
mvn package
```

javaprj-1.0-SNAPSHOT.jar 생성

(7) 인스톨 (설치): 로컬 저장소 (local repository) 에 설치된다.

```
mvn install
```



**레포지토리**

```
C:\Users\Connor\.m2\repository
```

로컬 저장소이다.

(8) 배포: 로컬저장소 -> 원격저장소

---

이 과정들이

이클립스 + 메이븐 플러그인으로 할 수 있다.



이클립스 - MvnClass 로 workspace 설정

maven project - next - Filter 에 quickstart (java project) 검색 - 



github.ywchang             maven-archetype-quickstart 선택

Group id: com.newlecture

Artifact id: mJavaPro



jar 파일 이렇게 추가할 수 있다.

프로젝트 우클릭 - Maven



Show View - maven 검색 후 maven repository



mvn repository: https://mvnrepository.com/

springTiles 프로젝트를 STSMVC02 프로젝트 설정



이클립스 -> 다이나믹 웹 프로젝트 생성 + 스프링 모듈 + 코딩

STS 툴 -> 스프링 MVC 프로젝트 생성해서 개발

**[다른프로젝트 -> 스프링프로젝트]**

1. web.xml 파일을 web_original.xml 파일명 수정 - 사용 X
   - springTiles 프로젝트의 web.xml 복사해서 붙이기
2. spring 폴더 servlet-context.xml, root-context.xml 사용 X
   - springTiles 프로젝트의 dispatcher-service.xml, dispatcher-servlet.xml
   - tiles-defs.xml 복사 붙이기
   - lib 폴더 - jar 파일을 추가 X
   - pom.xml
3. WEB-INF/views 폴더 생성해서 모든 jsp 파일 옮겨놨다.
   - views 복사
   - lib 폴더 - jar 파일을 추가 X
4. springTiles 프로젝트
5. springTiles 프로젝트의 webapp 폴더 안에
   - css
   - customer
   - images
   - inc
   - joinus
   - js
   - mypage 
   - STSMVC02 프로젝트의 webapp 폴더 안에 복사 붙이기
   - 5-2. index.css, index.htm 복사
6. pom.xml 모듈 추가







org.doit.web 에 controllers 와 newlecture 패키지를 복사한다.



**pom.xml**

```xml
<version>${org.springframework-version}</version>
```

properties 의 4.0.4.RELEASE 값을 가져온다.



```xml
<!-- Test: 112 번째 줄 -->
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>4.12</version>
    <scope>test</scope>
</dependency>        
```

4.7 -> 4.12 로 수정한다.

- [Maven Repository](https://tiles.apache.org/download.html#Tiles_2_as_a_Maven_dependency) - 

```xml
<dependency>
    <groupId>org.apache.tiles</groupId>
    <artifactId>tiles-jsp</artifactId>
    <version>2.2.2</version>
</dependency>
```

이 코드를 추가하면 tiles 관련 jar 파일들이 추가된다.

사이트가서 찾기 힘드므로

https://mvnrepository.com/ 에서 tiles 를 검색한다.

[Tiles JSP Support](https://mvnrepository.com/artifact/org.apache.tiles/tiles-jsp) - maven 탭의 dependency 코드 붙여넣는다.

spring-jdbc 검색 - [4.0.2.RELEASE](https://mvnrepository.com/artifact/org.springframework/spring-jdbc/4.0.2.RELEASE)

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>4.0.2.RELEASE</version>
</dependency>
```

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>${org.springframework-version}</version>
</dependency>
```

이렇게 작성하는 것이 확장성에 좋다.



(3) fileUpload

(4)



fileupload 검색 - Apache Commons FileUpload](https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload) - 1.2

```xml
<dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.2</version>
</dependency>
```

cglib 검색 - [CGLib](https://mvnrepository.com/artifact/cglib/cglib) - 

```xml
<dependency>
    <groupId>cglib</groupId>
    <artifactId>cglib</artifactId>
    <version>2.2</version>
</dependency>
```



톰캣 [8.5.73](https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-dbcp/8.5.73)

```xml
<dependency>
    <groupId>org.apache.tomcat</groupId>
    <artifactId>tomcat-dbcp</artifactId>
    <version>8.5.73</version>
</dependency>
```



ojdbc

라이센스문제로 메이븐 레포지토리에 있는 걸 사용하면 안된다.

로컬저장소 .m2 > repository mvn 메이븐 빌드도구를 사용해서 



(6) pom.xml 모듈 추가

- c:\ojdbc6.jar 확인
- cmd
- `cd c:\` 로컬 저장소에 ojdbc6.jar 등록 (install)

**cmd**

```
mvn install:install-file  "-Dfile=ojdbc6.jar" "-DgroupId=com.oracle" "-DartifactId=ojdbc" "-Dversion=6.0" "-Dpackaging=jar"
```

쌍따옴표 없어도 된다.

패키지: -DgroupId=com.oracle

프로젝트명: -DartifactId=ojdbc

버전: Dversion=6.0

**결과**

```
[INFO] --- maven-install-plugin:2.4:install-file (default-cli) @ standalone-pom ---
[INFO] Installing c:\ojdbc6.jar to C:\Users\Connor\.m2\repository\com\oracle\ojdbc\6.0\ojdbc-6.0.jar
[INFO] Installing C:\Users\Connor\AppData\Local\Temp\mvninstall3856202711984190658.pom to C:\Users\Connor\.m2\repository\com\oracle\ojdbc\6.0\ojdbc-6.0.pom
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
```



```
C:\Users\Connor\.m2\repository\com\oracle\ojdbc\6.0\ojdbc-6.0.pom
```

이 경로에 저장된다.

혹은 다른방법

프로젝트 우클릭 - maven - add dependency 검색

```xml
<!-- 7. ojdbc -->
<dependency>
    <groupId>com.oracle</groupId>
    <artifactId>ojdbc</artifactId>
    <version>6.0</version>
</dependency>	
```

ojdbc-6.0.pom 에서 groupId 부터 세 줄을 가져온다.



**오류**

```java
@Controller("o_homeController")
```

클래스명이 겹치면 컨트롤러 이름을 변경한다.



**[STSMVC03]**

WEB-INF/spring/root-context.xml: dispatcher-service.xml

WEB-INF/spring/appServlet/servlet-context.xml: dispatcher-service.xml



**web.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee https://java.sun.com/xml/ns/javaee/web-app_2_5.xsd">

	<!-- The definition of the Root Spring Container shared by all Servlets and Filters -->
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>/WEB-INF/spring/root-context.xml</param-value>
	</context-param>
	
	<!-- Creates the Spring Container shared by all Servlets and Filters -->
	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>

	<!-- Processes application requests -->
	<servlet>
		<servlet-name>appServlet</servlet-name>
		<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
		<init-param>
			<param-name>contextConfigLocation</param-name>
			<param-value>/WEB-INF/spring/appServlet/servlet-context.xml</param-value>
		</init-param>
		<load-on-startup>1</load-on-startup>
	</servlet>
		
	<servlet-mapping>
		<servlet-name>appServlet</servlet-name>
		<url-pattern>*.htm</url-pattern>
	</servlet-mapping>
	
	<!-- 인코딩 -->
    <filter>
      <filter-name>encodingFilter</filter-name>
      <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
      <init-param>
         <param-name>encoding</param-name>
         <param-value>UTF-8</param-value>
      </init-param>
    </filter>
    <filter-mapping>
      <filter-name>encodingFilter</filter-name>
      <url-pattern>/*</url-pattern>
    </filter-mapping>
</web-app>
```

**root-context.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd">
	
	<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="oracle.jdbc.driver.OracleDriver"></property>
		<property name="url" value="jdbc:oracle:thin:@localhost:1521:xe"></property>
		<property name="username" value="scott"></property>
		<property name="password" value="tiger"></property>
	</bean>
	
<!-- 	NamedParameterJddbcTemplate 템플릿 클래스 사용 -->
	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
		<constructor-arg ref="dataSource"/>
	</bean>
	
	<!-- 스프링 트랜잭션을 처리할 트랜잭션 메니져 등록 -->
	<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource"/>
	</bean>
	
	<!-- 트랜잭션 템플릿 객체 -->
	<bean id="transactionTemplate" class="org.springframework.transaction.support.TransactionTemplate">
		<property name="transactionManager" ref="transactionManager"/>
	</bean>
</beans>
```

**servlet-context.xml**

```xml
```



nameespaces 에서 체크만 하면 자동으로 import 된다.

root-context.xml 에서 beans Graph 를 볼 수 있다.

