---
title: 강의23
category: fullstack-class
---

# 1.4

![image-20220104094155686](../../../assets/images/image-20220104094155686.png)



**FileTestController.java**

```java
public class FileTestController extends HttpServlet {

	@Override
	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		// commandHandler.properties 파일 X
		// [M]VC 모델 X
		// 어떤 요청 URL 에 어떤 커맨드핸들러 객체가 로직처리 X
		String uri = request.getRequestURI();
		Connection con = null;

		try {
			con = ConnectionProvider.getConnection();
			String saveDirectory = request.getRealPath("/days10/upload");
			System.out.println(saveDirectory);
			File saveDir = new File(saveDirectory);
			if (!saveDir.exists())
				saveDir.mkdirs();

			FileTestDAO dao = FileTestDAO.getInstance();

			if (uri.indexOf("list.ss") != -1) {
				ArrayList<FileTestDTO> list = dao.selectFileList(con);
				request.setAttribute("list", list);
				String path = "/days10/ex05_list.jsp";
				RequestDispatcher dispatcher = request.getRequestDispatcher(path);
				dispatcher.forward(request, response);

			} else if (uri.indexOf("write.ss") != -1) {
				// 리다이렉트
				String path = "/days10/ex05_write.jsp";
				RequestDispatcher dispatcher = request.getRequestDispatcher(path);
				dispatcher.forward(request, response);
				

			} else if (uri.indexOf("write_ok.ss") != -1) {
				// request X null -> cos.jar -> mrequest ㄱ.ㄴ.ㄷ.ㄹ.ㅁ.
				int maxPostSize = 5 * 1024 * 1024; // 5MB
				String encoding = "UTF-8";
				
				// cos.jar 파일 중복 -> 클래스 a.txt -> a-(1).txt
				FileRenamePolicy policy = new DefaultFileRenamePolicy();
				MultipartRequest mrequest = new MultipartRequest(
						request
						, saveDirectory
						, maxPostSize
						, encoding
						, policy
						);
				// -> 벌써 업로드한 파일은 저장 완료!!!
				
				// ㄴ. dto
				FileTestDTO dto = new FileTestDTO();
				String subject = mrequest.getParameter("subject");
				dto.setSubject(subject);
				
				// 첨부파일 유무
				File uploadFile = mrequest.getFile("attachFile");
				
				if (uploadFile != null) {
					String fileName = uploadFile.getName();
					long fileLength = uploadFile.length();
					String originalFileName = mrequest.getOriginalFileName("attachFile");
					String filesystemName = mrequest.getFilesystemName("attachFile");	
					
					dto.setFilesystemname(filesystemName);
					dto.setOriginalfilename(originalFileName);
					dto.setFilelength(fileLength);
				}
				int rowCount = dao.insert(con, dto);
				response.sendRedirect("list.ss");

			} else if (uri.indexOf("delete.ss") != -1) {
				// delete.ss?num=1
				// ㄱ. 1번 게시글의 첨부파일이 있는지 확인 - O
				// ㄴ. DB delete + 첨부파일 삭제
				
				int num = Integer.parseInt(request.getParameter("num"));
				String filesystemname = request.getParameter("filesystemname");
				
				String pathname = String.format("%s%s%s"
						, saveDirectory, File.separator, filesystemname);
				File deleteFile = new File(pathname);
				
				if (deleteFile.exists()) {
					deleteFile.delete();
				}
				
				int rowCount = dao.delete(con, num);
				String location = request.getContextPath() + "/days10/ex05_list.ss";
				response.sendRedirect(location);
			} else if (uri.indexOf("update.ss") != -1) {

			}
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			JdbcUtil.close(con);
		} // try
	} // doGet

	@Override
	protected void doPost(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		doGet(request, response);
	}
}
```

**ex05_list.jsp**

```jsp
<h3 style="text-align:center">FileList - ex05_list.jsp</h3>
<table style="width:600px" border="1" align="center">
    <tr>
        <td align="right" colspan="4">
            <a href="write.ss">WRITE</a>
        </td>
    </tr>
    <tr>
        <td align="center" width="50">글번호</td>
        <td align="left" >제목</td>
        <td align="center" width="200">첨부파일</td>
        <td align="center" width="50">삭제</td>
    </tr>  
    <c:forEach items="${ list }" var="dto">
        <tr>
            <td align="center" width="50">${ dto.num }</td>
            <td align="left" >${ dto.subject }</td>
            <td align="center" width="200">          
                <a href="/jspPro/days10/upload/${ dto.filesystemname }"> ${ empty dto.originalfilename ? "없음" :  dto.originalfilename}</a>
            </td>
            <td align="center" width="50">
                <a href="delete.ss?num=${ dto.num }&filesystemname=${ dto.filesystemname}">삭제</a>
                <a href="update.ss?num=${ dto.num }&filesystemname=${ dto.filesystemname}">수정</a>
            </td>
        </tr>
    </c:forEach>
</table>
```



**ex05_write.jsp**

```jsp
<h3 style="text-align: center">ex05_write.jsp</h3>
<form 
      action="write_ok.ss" 
      method="post"
      enctype="multipart/form-data" >
    <table border="1" style="width: 500px;" align="center">
        <tr>
            <td> subject </td>
            <td> <input type="text" name="subject" /></td>
        </tr>
        <tr>
            <td> attach file </td>
            <td><input type="file" name="attachFile" /></td>
        </tr>
        <tr>
            <td colspan="2"><input type="submit" /></td>
        </tr>
    </table>
</form>	
```

파일업로드와 삭제까지 구현했다.



**FileTestController.java**

```java
public class FileTestController extends HttpServlet{
 
   private static final long serialVersionUID = -8272952047829416881L;

   @Override
   protected void doGet(HttpServletRequest request
         , HttpServletResponse response) throws ServletException, IOException {
        //  commandHandler.properties 파일  X
       //  [M]VC  모델 X
       // 어떤 요청 URL 에 어떤 커맨드핸들러 객체 가 로직 처리. X
      String uri = request.getRequestURI();
      Connection con = null;
      
      try {
         con = ConnectionProvider.getConnection();         
         String saveDirectory = request.getRealPath("/days10/upload");
         System.out.println( saveDirectory ); 
         File saveDir = new File( saveDirectory );
         if( !saveDir.exists() ) saveDir.mkdirs();         
         FileTestDAO dao = FileTestDAO.getInstance();
         
         if( uri.indexOf("list.ss") != -1 ) {
            
            ArrayList<FileTestDTO> list =  dao.selectFileList(con);
            request.setAttribute("list", list);
            String path = "/days10/ex05_list.jsp";
            RequestDispatcher dispatcher = request.getRequestDispatcher(path);
            dispatcher.forward(request, response);
            
         }else if( uri.indexOf("write.ss") != -1 ) {
            
            RequestDispatcher dispatcher = request.getRequestDispatcher("/days10/ex05_write.jsp");
            dispatcher.forward(request, response);
            
         }else if( uri.indexOf("write_ok.ss") != -1 ) {
            // ㄱ. request X null    -> cos.jar -> mrequest ㄱ.ㄴ.ㄷ.ㄹ.ㅁ
            int maxPostSize = 5 * 1024 * 1024 ;  // 5MB
            String encoding = "UTF-8"; 
            FileRenamePolicy policy = new DefaultFileRenamePolicy();
            MultipartRequest mrequest = new MultipartRequest(
                  request
                  ,  saveDirectory       
                  ,  maxPostSize
                  , encoding
                  , policy
                  );
            //      -> 벌써 업로드한  파일은  저장 완료!!! 
            
            // ㄴ. dto
                FileTestDTO dto = new FileTestDTO();
            String subject = mrequest.getParameter("subject");
            dto.setSubject(subject); 
            // 첨부파일 유무
            File uploadFile = mrequest.getFile("attachFile");
            if ( uploadFile != null ) {
               
               String fileName = uploadFile.getName(); 
               long fileLength = uploadFile.length(); 
               String originalFileName = mrequest.getOriginalFileName("attachFile");
               String filesystemName = mrequest.getFilesystemName("attachFile");

               dto.setFilesystemname(filesystemName);
               dto.setOriginalfilename(originalFileName);
               dto.setFilelength(fileLength);
            }
            
            int rowCount = dao.insert(con, dto);
            response.sendRedirect("list.ss");
             
         }else if( uri.indexOf("delete.ss") != -1 ) {
            // delete.ss?num=1&filesystemname=steup.log
            // ㄱ. 1번 게시글의 첨부파일이 있는지 확인 - O
            //  ㄴ. DB delete  + 첨부파일 삭제
            
            int num = Integer.parseInt( request.getParameter("num") );
            String filesystemname = request.getParameter("filesystemname");
            
            String pathname = String.format("%s%s%s"
                  , saveDirectory, File.separator,   filesystemname);
            File deleteFile = new File(pathname);
            if (deleteFile.exists()) {
               deleteFile.delete();
            }
            
            int rowCount = dao.delete(con, num);
            
            String location = "/jspPro/days10/ex05_list.ss";
            response.sendRedirect(location);
            
         }else if( uri.indexOf("update.ss") != -1 ) {
            // update.ss?num=1&filesystemname=Setup.log
            int num = Integer.parseInt( request.getParameter("num") );
            FileTestDTO dto = dao.selectOne(con, num);
            request.setAttribute("dto", dto);
            
            RequestDispatcher dispatcher = request.getRequestDispatcher("/days10/ex05_update.jsp");
            dispatcher.forward(request, response);
            
         }else if( uri.indexOf("update_ok.ss") != -1 ) {
            // ㄱ. write_ok.ss  코딩을 복사 -> 붙이기
            int maxPostSize = 5 * 1024 * 1024 ;  // 5MB
            String encoding = "UTF-8"; 
            FileRenamePolicy policy = new DefaultFileRenamePolicy();
            MultipartRequest mrequest = new MultipartRequest(
                  request
                  ,  saveDirectory       
                  ,  maxPostSize
                  , encoding
                  , policy
                  );
            //      -> 벌써 업로드한  파일은  저장 완료!!! 
            
            // ㄴ. dto
                FileTestDTO dto = new FileTestDTO();
                int num = Integer.parseInt( mrequest.getParameter("num") );
            dto.setNum( num );    
            String subject = mrequest.getParameter("subject");
            dto.setSubject(subject); 
            // 첨부파일 유무
            File uploadFile = mrequest.getFile("attachFile");
            if ( uploadFile != null ) {   //  a.txt파일 삭제                         b.txt 파일 추가
               
               String fileName = uploadFile.getName(); 
               long fileLength = uploadFile.length(); 
               String originalFileName = mrequest.getOriginalFileName("attachFile");
               String filesystemName = mrequest.getFilesystemName("attachFile");

               dto.setFilesystemname(filesystemName);
               dto.setOriginalfilename(originalFileName);
               dto.setFilelength(fileLength);
               
               // 첨부된 파일이 있다면 이전 첨부파일은 삭제 코딩 추가...
               String delete_filesystemname = mrequest.getParameter("filesystemname");
               String deleteFilePath = String.format("%s%s%s",   saveDirectory, File.separator,delete_filesystemname);   
               
               File deleteFile = new File(deleteFilePath);
               if( deleteFile.exists() ) deleteFile.delete(); 
               
               // 1번             제목          파일1     [수정]
               // update.jsp 이동
               // 제목 수정
               // 파일 새로 선택 파일2
               // [수정하기]
            }else {
               // 제목만 수정                + 원래 수정 전 파일 존재 유무
               dto = dao.selectOne(con, num);
               dto.setSubject(mrequest.getParameter("subject"));
            } 
            
            int rowCount = dao.update(con, dto);
            response.sendRedirect("list.ss");
            
            
         } // if
      } catch (Exception e) {
         e.printStackTrace();
      }finally {
           try {
            con.close();
          } catch (SQLException e) { 
            e.printStackTrace();
         }   
      } // try      
      
   } // doGet

   @Override
   protected void doPost(HttpServletRequest request
         , HttpServletResponse response) throws ServletException, IOException {
      doGet(request, response);
   }
}
```

수정까지 잘 구현된다.







**[ajax]**

오후 

```jsp
<!--
    days11 폴더 추가 
    ㄴ ex01.jsp 파일 추가

    [ AJAX 에이작스, 아작스 ([A]synchronous [J]avascript [A]nd [X]ML))-]
    비동기적인            자바스크립스               XML
    ㄱ. 자바스크립트 언어를 사용해서 XML 데이터를 비동기적으로 서버-클라이언트의  처리 기술
    ㄴ. 비동기적 의미 ? 웹 페이지 전체를 다시 요청->응답 X  로딩되지 않고    웹 페이지를 업데이트
    ㄷ. 예)
    예) 회원가입 
    이름
    생년월일
    주소
    기타
    기타
    아이디 : [             kenik          ] [아이디중복체크 버튼]
기타
    기타
    기타
    기타

    ㄹ. AJAX 장점     
    ㄱ. 페이지 전체 요청 X -> 성능 향샹                                        
    - 필요한 데이터만 수신하기 때문에 데이터 양을 줄일 수 있다.
    ㄴ. 마치 스레드 처럼 서버 처리하는 동안 기다리지 않고, 또 다른 비동기 처리 요청 가능.
    네이버 메인의  실시간으로 바뀌는 부분 (   날씨 정보,    검색 , 뉴스 순위 )    
    기상청서버   네서버   연합뉴스서버
    ㄷ. 서버 측 처리를 각각 PC에서 분산 처리 가능
    ㅁ.  AJAX 단점
    ㄱ.  보안 취약 ( 오픈 소스 )
    ㄴ. 차별화  X
    ㄷ. 브라우저 호환성 체크              
    ㅂ. AJAX 활용   
    ㄱ. 회원가입  - 우편번호 검색
    [ ID 중복 체크 ]
    ㄴ. 게시판 , 한줄 댓글 처리
    등등  

    ㅅ.   AJAX 처리를 하기 위한 절차(방법)   **** 
    1) 비동기적으로 처리하는 객체 - 브라우저 내장 객체
    XMLHttpRequest 객체  == 심부름꾼( 스레드 )
    2) js / jquery  로 XMLHttpRequest 객체를 얻어오는 코딩.
    var 변수명 =  new XMLHttpRequest()
    예외) IE5/6
    var 변수명 = new ActiveXObject("Microsoft.XMLHTTP");

var xmlHttp ;  
if( window.XMLHttpReqeust ){
    xmlHttp = new XMLHttpRequest()
} else{
    xmlHttp =new ActiveXObject("Microsoft.XMLHTTP");
} else{
    xmlHttp = null;
} 

3) 요청 설정 
    open() - 요청에 대한 설정하는 함수
    send() - 실제 요청하는 함수   
    4) 콜백함수( callback )  호출    
    DOM 을 사용해서 처리 결과 출력.

    5) 서버 요청
    ㄱ. get 방식
    ㄱ) XMLHttpRequest 객체
    ㄴ) XMLHttpRequest 객체.open("GET", "/test.jsp?id=admin", true);
ㄷ. XMLHttpRequest 객체.send(null);                     

ㄴ. post   방식
    ㄱ) XMLHttpRequest 객체
    ㄴ) XMLHttpRequest 객체.open("POST", "/test.jsp", true);
ㄷ) XMLHttpRequest 객체.send("id=admin");

ㅇ. 최신 브라우저에는 도메인 간 엑세스 허용 X ( 보안상 이유 )
    ㅈ. 최신 브라우저는          XMLHttpRequest 객체 대신에   Fetch API 를 사용할 수 있다.     

    ㅊ. XMLHttpRequest 객체의 메서드
    ㄱ. new XMLHttpRequest()
    ㄴ. open( method, url, async, user, passwd )
    ㄷ. send( [param] )
    ㄹ. abort()  현재 요청 취소
    ㅁ. getAllResponseHeader()
    getResponseHeader( name )
    setRequestHeader()

    ㅋ.  XMLHttpRequest 객체의 속성
    ㄱ. onreadystatechange 속성 =  XMLHttpRequest 객체의 준비상태(readystate)가 바뀔 때 마다 호출되는 이벤트 함수
    이벤트
    ㄴ. readyState 속성
    0   요청이 초기화 되지 않았다.
    1   서버 연결 설정
    2    요청 접수
    3   요청 처리
    [ 4   요청이 완료되었고 응답 준비가 되었다. ]
    ㄷ. state 속성 : 요청 결과를 정수 반환.
        404 : 요청 페이지를 찾을 수 없다.
            400
            403 : 금지
                [ 200: 확인 ]     

                ㄹ.  responseText 속성 :  응답결과  String 반환 
                    responseXML 속성 :  응답결과  XML 반환 
                        -->
```



**ajax 예시**

![image-20220104143515068](../../../assets/images/image-20220104143515068.png)

```jsp
서버 요청 시간 : <%= new Date().toLocaleString() %>
<br>

<input type="button" value="js ajax" onclick="load('ex02_ajax_info.txt')" />
<br>
<input type="button" value="jquery ajax" id="btnAjax" />
<br>
<div id="demo"></div>	

<script>
    var httpRequest; 
    function getXMLHttpReqeust(){
        if( window.ActiveXObject ){   // IE
            try{
                return new ActiveXObject("Msxml2.XMLHTTP");   // 
            }catch(e){
                try{
                    return new ActiveXObject("Microsoft.XMLHTTP");
                }catch(e){
                    return null;
                }
            }
        }else if( window.XMLHttpRequest ){
            return new XMLHttpRequest();
        }else{
            return null;
        }
    }	


    function load(url){
        // 1. XMLHttpRequest 객체 얻어오기
        httpRequest = getXMLHttpReqeust();
        // 2. 요청 설정 : open()
        httpRequest.onreadystatechange = callback;
        httpRequest.open("GET", url, true);
        // 3. 요청 실행 : send()
        httpRequest.send();
    }

    function callback(){
        if( httpRequest.readyState == 4 ){  // 요청 완료!!
            if(httpRequest.status == 200 ){   // 성공적 
                $("#demo").html(httpRequest.responseText);
            } else {
                alert("> 에이작스 요청 실패: " + httpRequest.status);
            }
        }
    }		

</script>
```



**jQuery**

```javascript
$("#btnAjax").on("click", function(event) {

    // jquery ajax method: load()
    $("#demo").load('ex02_ajax_info.txt', function(response, status, xhr) {
        if (status == "success") $(this).html(response);
        else if (status == "error") alert(xhr.status + " : " + xhr.statusText);
    });
});
```





**ex03.jsp**

이 웹페이지를 로딩할 때 jquery ajax 를 사용해서 ex03_load.html 을 읽어와서 ol 태그의 자식 li 태그를 읽어와서 #new-projects 가진 ol 태그에 자식 추가





ex03.jsp

```jsp
<ol id="new-projects"></ol>

<script>
    $(function() {
        $("#new-projects").load("ex03_load.html #projects li");
    });
</script>
```

ex03_load.html

```html
<ul id="projects">
   <li>jQuery</li>
   <li>jQuery UI</li>
   <li>jQuery Mobile</li>
   <li>QUnit</li>
   <li>Sizzle</li>
</ul>
```





**ex04_top5.jsp**

```jsp
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<%@page import="java.util.Calendar"%>
<%@page import="com.util.ConnectionProvider"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>

<%
  Connection conn = null;
  PreparedStatement pstmt = null;
  ResultSet rs = null;
  // TOP 5
  String sql = "with temp as ("
              +"   select empno, ename, sal, "
              +"          rank() over(order by sal desc) r "
              +"   from emp "
              +")"
              +" select * from temp "
              +" where r <= 5 ";
  
  Calendar cal = Calendar.getInstance();
  String now = String.format("%tT", cal);
  
  String responseText = "<h3>" + now + "</h3>";
  try{
     conn =  ConnectionProvider.getConnection();
     pstmt = conn.prepareStatement(sql);
     rs =  pstmt.executeQuery();
     while(rs.next()){
        int rank = rs.getInt("r");
        int empno = rs.getInt("empno");
        String ename = rs.getString("ename");
        double sal = rs.getDouble("sal");
        
        responseText +=String.format("<li>[%d] %d %s\t\t(%.2f)</li>"
              , rank, empno, ename, sal);
     } 
  }catch(Exception e){
     e.printStackTrace();
  }finally{
     try{
        pstmt.close();rs.close();conn.close();
     }catch(Exception e){}
  }
%>
<%= responseText %>
```



**httpRequest.js**

```javascript
/**
 * httpReqeust.js
 */

var httpRequest = null;

function getXMLHttpRequest(){
   if(window.ActiveXObject){
      try {
         return new ActiveXObject("Msxml2.XMLHTTP");
      } catch (e) {
         try {
            return new ActivXObject("Microsoft.XMLHTTP");
         } catch (e) {
            return null;
         }

      }
   }else if(window.XMLHttpRequest){
      return new XMLHttpRequest();       
   }else {
      return null;
   }
}

//  요청할 url, 파라미터, 콜백함수등록, get/post
function sendRequest(url,params,callback,method){ 
   
   httpRequest = getXMLHttpRequest();    
   
   var httpMethod= method?method:'GET';   
    
   if(httpMethod!='GET' && httpMethod!='POST') httpMethod='GET';
    
   var httpParams = (params==null||params=="")?null:params;
   
   var httpUrl = url;
   
   if(httpMethod=='GET' && httpParams != null){
      httpUrl= httpUrl +"?"+httpParams;
   }     
   
   httpRequest.open(httpMethod,httpUrl,true); // true 비동기적..
   // [XMLHTTP를 사용해서 통신할 때 규약] 
   // httpRequest.setRequestHeader('Content-Type','application/x-www-form-unlencoded');    
   httpRequest.onreadystatechange = callback;    
   httpParams = (httpMethod=='POST'?httpParams:null );
   httpRequest.send( httpParams); // 요청처리...
}
```



`xhr` XMLHttpRequest 의 약어





![image-20220104150229755](../../../assets/images/image-20220104150229755.png)





```sql
--  king 7839   sal 1000 update
update emp
set sal = 1000
where empno = 7839;
commit;
--  king 7839   sal 1000 update
update emp
set sal = 5000
where empno = 7839;
commit;              
```

# 1.5

**[ajax]**

xhr 객체 == 스레드

`open(, callback)` 메서드로 설정

`send()` 

`function callback(){}` 상태가 바뀌면 

내일: 구글맵 API



**ex01_cd_catalog.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<CATALOG>
  <CD>
    <TITLE>Empire Burlesque</TITLE>
    <ARTIST>Bob Dylan</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>Columbia</COMPANY>
    <PRICE>10.90</PRICE>
    <YEAR>1985</YEAR>
  </CD>
  <CD>
    <TITLE>Hide your heart</TITLE>
    <ARTIST>Bonnie Tyler</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>CBS Records</COMPANY>
    <PRICE>9.90</PRICE>
    <YEAR>1988</YEAR>
  </CD>
  <CD>
    <TITLE>Greatest Hits</TITLE>
    <ARTIST>Dolly Parton</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>RCA</COMPANY>
    <PRICE>9.90</PRICE>
    <YEAR>1982</YEAR>
  </CD>
  <CD>
    <TITLE>Still got the blues</TITLE>
    <ARTIST>Gary Moore</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Virgin records</COMPANY>
    <PRICE>10.20</PRICE>
    <YEAR>1990</YEAR>
  </CD>
  <CD>
    <TITLE>Eros</TITLE>
    <ARTIST>Eros Ramazzotti</ARTIST>
    <COUNTRY>EU</COUNTRY>
    <COMPANY>BMG</COMPANY>
    <PRICE>9.90</PRICE>
    <YEAR>1997</YEAR>
  </CD>
  <CD>
    <TITLE>One night only</TITLE>
    <ARTIST>Bee Gees</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Polydor</COMPANY>
    <PRICE>10.90</PRICE>
    <YEAR>1998</YEAR>
  </CD>
  <CD>
    <TITLE>Sylvias Mother</TITLE>
    <ARTIST>Dr.Hook</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>CBS</COMPANY>
    <PRICE>8.10</PRICE>
    <YEAR>1973</YEAR>
  </CD>
  <CD>
    <TITLE>Maggie May</TITLE>
    <ARTIST>Rod Stewart</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Pickwick</COMPANY>
    <PRICE>8.50</PRICE>
    <YEAR>1990</YEAR>
  </CD>
  <CD>
    <TITLE>Romanza</TITLE>
    <ARTIST>Andrea Bocelli</ARTIST>
    <COUNTRY>EU</COUNTRY>
    <COMPANY>Polydor</COMPANY>
    <PRICE>10.80</PRICE>
    <YEAR>1996</YEAR>
  </CD>
  <CD>
    <TITLE>When a man loves a woman</TITLE>
    <ARTIST>Percy Sledge</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>Atlantic</COMPANY>
    <PRICE>8.70</PRICE>
    <YEAR>1987</YEAR>
  </CD>
  <CD>
    <TITLE>Black angel</TITLE>
    <ARTIST>Savage Rose</ARTIST>
    <COUNTRY>EU</COUNTRY>
    <COMPANY>Mega</COMPANY>
    <PRICE>10.90</PRICE>
    <YEAR>1995</YEAR>
  </CD>
  <CD>
    <TITLE>1999 Grammy Nominees</TITLE>
    <ARTIST>Many</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>Grammy</COMPANY>
    <PRICE>10.20</PRICE>
    <YEAR>1999</YEAR>
  </CD>
  <CD>
    <TITLE>For the good times</TITLE>
    <ARTIST>Kenny Rogers</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Mucik Master</COMPANY>
    <PRICE>8.70</PRICE>
    <YEAR>1995</YEAR>
  </CD>
  <CD>
    <TITLE>Big Willie style</TITLE>
    <ARTIST>Will Smith</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>Columbia</COMPANY>
    <PRICE>9.90</PRICE>
    <YEAR>1997</YEAR>
  </CD>
  <CD>
    <TITLE>Tupelo Honey</TITLE>
    <ARTIST>Van Morrison</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Polydor</COMPANY>
    <PRICE>8.20</PRICE>
    <YEAR>1971</YEAR>
  </CD>
  <CD>
    <TITLE>Soulsville</TITLE>
    <ARTIST>Jorn Hoel</ARTIST>
    <COUNTRY>Norway</COUNTRY>
    <COMPANY>WEA</COMPANY>
    <PRICE>7.90</PRICE>
    <YEAR>1996</YEAR>
  </CD>
  <CD>
    <TITLE>The very best of</TITLE>
    <ARTIST>Cat Stevens</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Island</COMPANY>
    <PRICE>8.90</PRICE>
    <YEAR>1990</YEAR>
  </CD>
  <CD>
    <TITLE>Stop</TITLE>
    <ARTIST>Sam Brown</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>A and M</COMPANY>
    <PRICE>8.90</PRICE>
    <YEAR>1988</YEAR>
  </CD>
  <CD>
    <TITLE>Bridge of Spies</TITLE>
    <ARTIST>T'Pau</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Siren</COMPANY>
    <PRICE>7.90</PRICE>
    <YEAR>1987</YEAR>
  </CD>
  <CD>
    <TITLE>Private Dancer</TITLE>
    <ARTIST>Tina Turner</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>Capitol</COMPANY>
    <PRICE>8.90</PRICE>
    <YEAR>1983</YEAR>
  </CD>
  <CD>
    <TITLE>Midt om natten</TITLE>
    <ARTIST>Kim Larsen</ARTIST>
    <COUNTRY>EU</COUNTRY>
    <COMPANY>Medley</COMPANY>
    <PRICE>7.80</PRICE>
    <YEAR>1983</YEAR>
  </CD>
  <CD>
    <TITLE>Pavarotti Gala Concert</TITLE>
    <ARTIST>Luciano Pavarotti</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>DECCA</COMPANY>
    <PRICE>9.90</PRICE>
    <YEAR>1991</YEAR>
  </CD>
  <CD>
    <TITLE>The dock of the bay</TITLE>
    <ARTIST>Otis Redding</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>Stax Records</COMPANY>
    <PRICE>7.90</PRICE>
    <YEAR>1968</YEAR>
  </CD>
  <CD>
    <TITLE>Picture book</TITLE>
    <ARTIST>Simply Red</ARTIST>
    <COUNTRY>EU</COUNTRY>
    <COMPANY>Elektra</COMPANY>
    <PRICE>7.20</PRICE>
    <YEAR>1985</YEAR>
  </CD>
  <CD>
    <TITLE>Red</TITLE>
    <ARTIST>The Communards</ARTIST>
    <COUNTRY>UK</COUNTRY>
    <COMPANY>London</COMPANY>
    <PRICE>7.80</PRICE>
    <YEAR>1987</YEAR>
  </CD>
  <CD>
    <TITLE>Unchain my heart</TITLE>
    <ARTIST>Joe Cocker</ARTIST>
    <COUNTRY>USA</COUNTRY>
    <COMPANY>EMI</COMPANY>
    <PRICE>8.20</PRICE>
    <YEAR>1987</YEAR>
  </CD>
</CATALOG>
```



ex01.jsp xml 파일 -> js ajax -> table 구성



html 을 DOM 으로 불러오듯 xml 을 DOM 으로 불러온다.

![image-20220105093454045](../../../assets/images/image-20220105093454045.png)



**ex01.jsp**

```jsp
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
table, th, td {
	border: 1px solid black;
	border-collapse: collapse;
}

th, td {
	padding: 5px;
}
</style>
<title>Insert title here</title>
</head>
<body>
	<h3>days12.ex01.jsp</h3>

	<button type="button" onclick="loadDoc()">Get my CD collection</button>
	<br>
	<br>
	<table id="demo"></table>
	
	<script>
		function loadDoc() {
			// 1. xhr 객체
			var xhr = new XMLHttpRequest();
			
			// 4. callback(){table 구성}
			xhr.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					// String responseText
					// xml responseXML ***
					var xmlDoc = this.responseXML;
// 					alert(xmlDoc);
					var tblContent = "<tr><th>ARTIST</th> <th>TITLE</th></tr>";
					var cdList = xmlDoc.getElementsByTagName("CD");
					
					for (var i = 0; i < cdList.length; i++) {
						tblContent += "<tr>";
						tblContent += "<td>";
						tblContent += cdList[i].getElementsByTagName("ARTIST")[0].childNodes[0].nodeValue;
						tblContent += "</td>";
						tblContent += "<td>";
						tblContent += cdList[i].getElementsByTagName("TITLE")[0].childNodes[0].nodeValue;
						tblContent += "</td>";
						tblContent += "</tr>";
					}
					document.getElementById("demo").innerHTML = tblContent;
				}
			};
			
			// 2. open()
			xhr.open("GET", "ex01_cd_catalog.xml", true);
			
			// 3. send()
			xhr.send(null);
				
		}
	</script>


</body>
</html>
```

---



**[JSON]** ex02.jsp

1. Java Script Object Notation
2. ajax 보다 가벼운 데이터 교환 방식
3. 사람이 읽기쉽고 쓰기가 쉽다.
4. 기계가 구문분석, 생성, 사용이 쉽다.
5. JSON 메뉴얼: https://www.json.org/json-en.html
6. json 형식 - js Object 구문에서 파생되었다.
7. 주의
   - `{"name":value, "name":value}` 홑따옴표를 쓰면 안된다.
8. json 파일
   - 확장자: json



클라이언트 -> ajax -> 서버

js Ojbect -> json 형식의 문자열 변환 -> js Object 변환



javaScript

```javascript
var person {
    name: "admin"
    , age: 20
    , addr: "seoul"
};
```

JSON

```json
var personJSON {
    "name": "admin"
    , "age": 20
    , "addr": "seoul"
    , "cars": [   ]
    , "colors": "null"
    , "gender": "true"
};
```



1. js Object -> json 변환
2. json -> js Object 변환



```
{"name":"john","age":"20","city":"seoul"}
```

```javascript
// 1. js Object -> json 변환
var person = {
name: "john"
, age: "20"
, city: "seoul"
};

var personJSON = JSON.stringify(person);
console.log("personJSON", personJSON);
```



![image-20220105100753692](../../../assets/images/image-20220105100753692.png)

개발자도구 - application - localStorage



**[js <-> json]**

![image-20220105100940726](../../../assets/images/image-20220105100940726.png)

```jsp
<script>
    // 1. js Object -> json 변환
    var person = {
        name: "john"
        , age: "20"
        , city: "seoul"
    };

    var personJSON = JSON.stringify(person);
    console.log("personJSON", personJSON);
    localStorage.setItem("personJSON", personJSON);
</script>

<button onclick="getPersonName()">로컬 저장소 personJSON.name</button>
<br />
<p id="demo"></p>

<script>
    function getPersonName() {
        var getPersonJSON = localStorage.getItem("personJSON");

        // json -> js Object 변환
        var personObject = JSON.parse(getPersonJSON);
        document.getElementById("demo").innerHTML = personObject.name;
    }
</script>
```



JSON 파일의 생성

파일로 생성해서 확장자를 붙인다.



ex03_demo.json
ex03_demo_array.json
ajax 처리
ex03_dept.xml
ex03_dept.json

**ex03_demo.json**

```json
{
  "name":"John"  ,
  "age": 30 ,
  "pets": [
              { "animal":"dog", "name":"fido"},
              { "animal":"cat", "name":"test"},
              { "animal":"hamster", "name":"box"}
          ]
}
```

**ex03_demo_array.json**

```json
["Ford","BMW","Audi","Fiat"]
```

**ex03_dept.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<departments>  
   <dept>
      <deptno>10</deptno>
      <dname>ACCOUNTING</dname>
      <loc>NEW YORK</loc>
   </dept>
   <dept>
      <deptno>20</deptno>
      <dname>RESEARCH</dname>
      <loc>DALLAS</loc>
   </dept>
   <dept>
      <deptno>30</deptno>
      <dname>SALES</dname>
      <loc>CHICAGO</loc>
   </dept>
   <dept>
      <deptno>40</deptno>
      <dname>OPERATIONS</dname>
      <loc>BOSTON</loc>
   </dept>     
</departments>
```

**ex03_dept.json**

```json
{
   "departments":[
                        {"deptno":10, "dname":"ACCOUNTING", "loc":"NEW YORK"}
                       ,{"deptno":20, "dname":"RESEARCH", "loc":"DALLAS"}
                       ,{"deptno":30, "dname":"SALES", "loc":"CHICAGO"}
                       ,{"deptno":40, "dname":"OPERATIONS", "loc":"BOSTON  "}
             ]
}
```



**ex03.jsp**

![image-20220105102933895](../../../assets/images/image-20220105102933895.png)

```jsp
<button onclick="json_ajax_test()">ex03_dept.json -> ex03.jsp 페이지에서 js ajax 출력</button>
<br>
<p id="demo" ></p>	

<script>
    function json_ajax_test() {

        // 1. xhr 객체
        var xhr = new XMLHttpRequest();

        // 4. callback(){table 구성}
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var deptJSON = this.responseText;
                var dnameArray = [];
                var deptJsObject = JSON.parse(deptJSON);

                for (var i = 0; i < deptJsObject.departments.length; i++) {
                    var dname = deptJsObject.departments[i].dname;
                    dnameArray.push(dname);
                }
                document.getElementById("demo").innerHTML = "<li>" + dnameArray.join("</li><li>") + "</li>";
            }
        };

        // 2. open()
        xhr.open("GET", "ex03_dept.json", true);

        // 3. send()
        xhr.send(null);
    }
</script>
```



**[회원가입]** ex04.jsp

![image-20220105103320646](../../../assets/images/image-20220105103320646.png)

```jsp
<form action="" method="get">
    deptno : <input type="text" name="deptno" value="10" /><br>
    empno : <input type="text" name="empno" value="7369" />
    <input type="button" id="btnEmpnoCheck" value="empno 중복체크" />
    <p id="notice"></p>
    <br>
    ename : <input type="text" name="ename" value="" /><br>
    job : <input type="text" name="job" value="" /><br>
    <input type="submit" value="회원(emp) 가입" />
</form>	
```

**ex04_idcheck.jsp**

```jsp
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@page import="com.util.ConnectionProvider"%>
<%@page import="com.util.JdbcUtil"%>
<%@page import="net.sf.json.JSONObject"%>
<%@page import="java.sql.ResultSet"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="java.sql.Connection"%>

<%
      // json        {  "count":  1 }   또는  {  "count":  0}     ?empno=7369
      String empno = request.getParameter("empno");
      String sql = " select count(*) cnt " + 
                      " from emp  " + 
                      " where empno =  ?";
      Connection conn = null;
      PreparedStatement pstmt = null;
      ResultSet rs = null;
      
      String jsonResult = "{\"count\":";
      
       
      
      try{
         conn = ConnectionProvider.getConnection();
         pstmt = conn.prepareStatement(sql);
          pstmt.setString(1, empno);
          rs = pstmt.executeQuery();
          rs.next();
          int cnt = rs.getInt("cnt");  // 1      0
          jsonResult += cnt;
          jsonResult += "}";
      }catch(Exception e){
         e.printStackTrace();
      }finally{
         JdbcUtil.close(pstmt);
         JdbcUtil.close(rs);
         JdbcUtil.close(conn);
      }
%>
<%=jsonResult %>
```



Q. jQuery serialize() 함수

A.

## 함수

jQuery ajax 함수: $.ajax() - get/post json/xm/js 등등

- `getJSON()` get
- `getScript()`  get
- `post()`
- `load()` 

`$.ajax()` 가 위의 모든 기능을 사용할 수 있다.

ajax 메뉴얼

![image-20220105104544503](../../../assets/images/image-20220105104544503.png)

Category: Low-Level Interface 클릭



**ex04.jsp**

```jsp
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script 
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> 

<title>Insert title here</title>
</head>
<body>	
	<h3>ex04.jsp - 회원가입</h3>

	<form action="" method="get">
	    deptno : <input type="text" name="deptno" value="10" /><br>
	    empno : <input type="text" name="empno" value="7369" />
	    <input type="button" id="btnEmpnoCheck" value="empno 중복체크" />
	    <p id="notice"></p>
	    <br>
	    ename : <input type="text" name="ename" value="" /><br>
	    job : <input type="text" name="job" value="" /><br>
	    <input type="submit" value="회원(emp) 가입" />
	 </form>	
	 
	 <script>
	 	$(function() {
	 		$("#btnEmpnoCheck").on("click", function(event) {
	 			// ?empno=7369
	 			var params = $("form").serialize();
	 			
	 			// jQuery ajax 함수: 
	 			$.ajax({
	 				url:"ex04_idcheck.jsp" // 프로젝트 *** MVC idcheck.do -> 컨트롤러 -> 모델
	 				, dataType: "json" // text, html, xml, script 등등
	 				, type: "GET"
	 				, data: params
	 				, cache: false // 꼭 기억. DB 바뀌어도 안바뀌는경우가 있다.
	 				, success: function(data, textStatus, jqXHR) {
	 					// jqXHR == js xhr 객체
	 					// textStatus 상태
	 					// data == this.responseText, this.responseXML
	 					// JSON -> js Object 변환 (JSON.parse()) 할 필요 없다. 자동으로 변환된다.
	 					if (data.count == 0) {
	 						$("#notice").css("color", "black").text("사용 가능한 ID 입니다.");
	 					} else {
	 						$("#notice").css("color", "red").text("이미 사용중인 ID 입니다.");
	 						
	 					}
	 				}
	 				, error: function() {
	 					alert("에러~~");
	 				}
	 			});
	 		});
	 	});
	 </script>

</body>
</html>
```





```jsp
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY&callback=myMap"></script>
```



에러

```
util.js:251 Google Maps JavaScript API warning: InvalidKey https://developers.google.com/maps/documentation/javascript/error-messages#invalid-key
```



구글키 발급받아 넣기

