---
title: 강의19
category: fullstack-class
---

# 12.22

get 방식 -> 서블릿 -> 포워딩

post 방식 -> 서블릿 -> 포워딩

ex01.jsp Ex01.java

입력	?파라미터 request.getAttribute(결과물)

​	로직처리

​	request.setAttribute (결과물)



게시판: webapp 에 board 와 member 폴더를 만든다.



```javascript
$("form:last-of-type :button").on("click", function(event) {
    $(this).parents("form").submit();
});
```



**java**

```java
String location = "/days03/ex01_ok.jsp";
response.sendRedirect(location);
```

servlet 을 수정 후에는 서버를 재실행해야된다.



12/22 오전수업 다시듣기





각 부서원들을 테이블 형식으로 출력.

ex03.jsp -> 서블릿

**[JSTL]**

JSTL: Java Standard Tag Library 

복습: 프로젝트 생성 정리

파일받는 사이트: https://mvnrepository.com/

JSTL 검색 - 제일 많이 사용한 것 - 제일 많이 사용한 버전 - **Files** jars 받기

```jsp
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
```

jar 를 uri WEB-INF - lib 에 추가하고 uri 를 자동완성한다.

prefix 에 c 를 넣는다.

템플릿에 추가할 것

getAttribute 가 필요없이 바로 사용할 수 있다.

- `c:if` 



**JSTL: 부서테이블 예시**

```jsp
<%@page import="java.util.Iterator"%>
<%@page import="java.util.ArrayList"%>
<%@page import="days02.EmpDTO"%>
<%@page import="java.sql.PreparedStatement"%>
<%@page import="com.util.DBConn"%>
<%@page import="java.sql.*"%>
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%
String pdeptno = request.getParameter("deptno");

String sql = "SELECT * ";
sql += "FROM emp ";
sql += "WHERE deptno = ? ";
sql += "ORDER BY ename ASC";
//
Connection conn = DBConn.getConnection();

PreparedStatement pstmt = null;
ResultSet rs = null;

int empno;
String ename;
String job;
int mgr;
Date hiredate; // String -> java.sql.Date
double sal;
double comm;
int deptno;

EmpDTO dto = null;

ArrayList<EmpDTO> list = null;
try {
	pstmt = conn.prepareStatement(sql);
	pstmt.setInt(1, Integer.parseInt(pdeptno)); // ?
	rs = pstmt.executeQuery();

	if (rs.next()) {
		list = new ArrayList<>();
		do {

	empno = rs.getInt("empno");
	ename = rs.getString("ename");
	job = rs.getString("job");
	mgr = rs.getInt("mgr");
	// java.sql.Date
	hiredate = rs.getDate("hiredate"); // rs.getString("hiredate")
	sal = rs.getDouble("sal");
	comm = rs.getDouble("comm");
	deptno = rs.getInt("deptno");

	dto = new EmpDTO(empno, ename, job, mgr, hiredate, sal, comm, deptno);

	list.add(dto);
		} while (rs.next());
	} // if

	pstmt.close();
	rs.close(); // ***
} catch (SQLException e) {
	e.printStackTrace();
}

DBConn.close();

// list
request.setAttribute("elist", list);
%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<style>
</style>
<title>Insert title here</title>
</head>
<body>
	<%
	// list = (ArrayList<EmpDTO>) request.getAttribute("list");
	%>

	<h3>ex03_jstl.jsp</h3>
	<a href="ex03_jstl.jsp?deptno=30">ex03_jstl.jsp</a>
	<br />

	<table border="1" style="width: 100%">
		<thead>
			<tr>
				<th>deptno</th>
				<th>empno</th>
				<th>ename</th>
				<th>job</th>
				<th>hiredate</th>
			</tr>
		</thead>
		<tbody>
			<c:if test="${not empty elist }">
				<c:forEach items="${elist }" var="dto">
					<tr>
						<td>${dto.deptno}</td>
						<td>${dto.empno}</td>
						<td>${dto.ename}</td>
						<td>${dto.job}</td>
						<td>${dto.hiredate}</td>
					<tr>
				</c:forEach>
			</c:if>
			<c:if test="${empty elist }">
				<tr>
					<td colspan="5" style="height:200px;">사원이 존재하지 않습니다.</td>
				</tr>
			</c:if>
		</tbody>
		<tfoot>
			<tr>
				<td colspan="5">${param.deptno }번 부서원은 ${elist.size() }명입니다.</td>
			</tr>
		</tfoot>
	</table>

	<a href="<%=request.getContextPath()%>/scott/dept">다시하기</a>
	

	<script>
		
	</script></
			body>
</html>
```



**[어제 팀과제]**

test00.html 링크 클릭 -> 서블릿 (Test00.java) urlpattern = "/days03.test00.html"

> 서블릿 후에는 항상 서버 재실행할 것!!

**포워딩**

```java
request.getRequestDispatcher("ex04_test00.jsp").forward(request, response);
```

> java 폴더와 webapp 폴더는 맞추는게 좋다.
>
> 확장자를 꼭 붙여야 한다.

dispacher: 전달자. 

`요청.요청전달자.포워드` 



복습: ex04 

- select option
- `c:if`
- `c:forEach` 





**[ex05.jsp]**

/jspPro/days03/ex05.html -> 서블릿 -> ex05.jsp

```jsp
<%@page import="java.util.Iterator"%>
<%@page import="java.util.Map.Entry"%>
<%@page import="java.util.Set"%>
<%@page import="days02.EmpDTO"%>
<%@page import="java.util.ArrayList"%>
<%@page import="days03.SalgradeDTO"%>
<%@page import="java.util.LinkedHashMap"%>
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2021. 12. 22. - 오후 2:47:33</title>
<link rel="icon" type="image/x-icon" href="../images/SiSt.ico">

<link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
<script>
  $( function() {
    $( "#accordion" ).accordion();
    $( "#tabs" ).tabs();
  } );

</script>
 
<style>
</style>
</head>
<body>

<h3>ex05.jsp</h3>
<!-- 
 /jspPro/days03/ex05.html -> Ex05.java 서블릿 ->  ex05.jsp
                             포워딩
 -->
<%
  LinkedHashMap<SalgradeDTO, ArrayList<EmpDTO>> map =
          (LinkedHashMap<SalgradeDTO, ArrayList<EmpDTO>>)request.getAttribute("map");
%> 
<div id="accordion">
  <!-- 
  <h3>Section 1</h3>
  <div>
    <p>
    Mauris mauris ante, blandit et, ultrices a, suscipit eget, quam. Integer
    ut neque. Vivamus nisi metus, molestie vel, gravida in, condimentum sit
    amet, nunc. Nam a nibh. Donec suscipit eros. Nam mi. Proin viverra leo ut
    odio. Curabitur malesuada. Vestibulum a velit eu ante scelerisque vulputate.
    </p>
  </div>
   -->
   <%
   Set<Entry<SalgradeDTO, ArrayList<EmpDTO>>>  set = map.entrySet();
   Iterator<Entry<SalgradeDTO, ArrayList<EmpDTO>>> ir = set.iterator();

   while (ir.hasNext()) {
      Entry<SalgradeDTO, ArrayList<days02.EmpDTO>> entry = ir.next();
      SalgradeDTO dto = entry.getKey();
  %>
           <h3><%= String.format( "%d등급( %d~%d ) - %d명", dto.getGrade(), dto.getLosal(), dto.getHisal(), dto.getCnt() ) %></h3>
           <div>
           <%   
               ArrayList<EmpDTO> empList =  entry.getValue();
               Iterator<EmpDTO> e_ir =  empList.iterator();
               while (e_ir.hasNext()) {
                  EmpDTO edto =  e_ir.next();
            %>
            <p>
            <%=  String.format("\t%d\t%s\t%d\t%s\t%.2f\n",
                        edto.getDeptno(),
                          "" ,
                          edto.getEmpno(),
                          edto.getEname(),
                          edto.getSal()
                          )%> 
            </p>      
            <%                    
               } //  
            %>      
            </div>
   <%   
   } // while
   %>
</div>

	<hr />
	
	<div id="tabs">
<!--   <ul> -->
<!--     <li><a href="#tabs-1">Nunc tincidunt</a></li> -->
<!--     <li><a href="#tabs-2">Proin dolor</a></li> -->
<!--     <li><a href="#tabs-3">Aenean lacinia</a></li> -->
<!--   </ul> -->

	<ul>
  <%
	   set = map.entrySet();
	   ir = set.iterator();
	   int i = 1;

	   while (ir.hasNext()) {
	      Entry<SalgradeDTO, ArrayList<days02.EmpDTO>> entry = ir.next();
	      SalgradeDTO dto = entry.getKey();
  %>
           <li><a href="#tabs-<%=i%>"><%= String.format( "%d등급( %d~%d ) - %d명", dto.getGrade(), dto.getLosal(), dto.getHisal(), dto.getCnt() ) %></a></li>
   <%   
   		i++;
   } // while
   %>
	
	</ul>

<!--   <div id="tabs-1"> -->
<!--     <p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p> -->
<!--   </div> -->
<!--   <div id="tabs-2"> -->
<!--     <p>Morbi tincidunt, dui sit amet facilisis feugiat, odio metus gravida ante, ut pharetra massa metus id nunc. Duis scelerisque molestie turpis. Sed fringilla, massa eget luctus malesuada, metus eros molestie lectus, ut tempus eros massa ut dolor. Aenean aliquet fringilla sem. Suspendisse sed ligula in ligula suscipit aliquam. Praesent in eros vestibulum mi adipiscing adipiscing. Morbi facilisis. Curabitur ornare consequat nunc. Aenean vel metus. Ut posuere viverra nulla. Aliquam erat volutpat. Pellentesque convallis. Maecenas feugiat, tellus pellentesque pretium posuere, felis lorem euismod felis, eu ornare leo nisi vel felis. Mauris consectetur tortor et purus.</p> -->
<!--   </div> -->
<!--   <div id="tabs-3"> -->
<!--     <p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p> -->
<!--     <p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</p> -->
<!--   </div> -->

   <%
   set = map.entrySet();
   ir = set.iterator();
   i = 1;

   while (ir.hasNext()) {
      Entry<SalgradeDTO, ArrayList<days02.EmpDTO>> entry = ir.next();
      SalgradeDTO dto = entry.getKey();
  %>
           <div id="tabs-<%=i %>">
           <%   
               ArrayList<EmpDTO> empList =  entry.getValue();
               Iterator<EmpDTO> e_ir =  empList.iterator();
               while (e_ir.hasNext()) {
                  EmpDTO edto =  e_ir.next();
            %>
            <p>
            <%=  String.format("\t%d\t%s\t%d\t%s\t%.2f\n",
                        edto.getDeptno(),
                          "" ,
                          edto.getEmpno(),
                          edto.getEname(),
                          edto.getSal()
                          )%> 
            </p>      
            <%                    
               } //  
            %>      
            </div>
   <%   
   			i++;
   } // while
   %>

</div>

<script>
</script>
</body>
</html>
```

**[ex06.jsp]**

[jsp페이지] -> 요청 -> WAS [웹컨테이너]

​									서블릿 객체

​			<- 응답 - 

​			<- 응답 - 

								1) 데이터 전송 성능 향상
   								2) 버퍼
   								3) 버퍼 전송되기 전 헤드 변경 (조작)

```jsp
<%@ page contentType="text/html; charset=UTF-8" 
pageEncoding="UTF-8"
buffer="8kb"
autoFlush="true"
%>
```

- `buffer` 8kb 가 다 차면 전송
- `autoFlush` 용량이 다 차면 클라이언트로 자동 전송. 디폴트 true
- `import` 
- `isErrorPage`
- `isThreadSafe`
- `language`
- `session`
- `trimDirectiveWhitespaces` 디폴트 false. 전송할때 지시자 공백 제거. 

```
java.io.IOException: 오류: JSP 버퍼 오버플로우
```



```jsp
<%@ page 
buffer="1kb"
autoFlush="false"
%>
```



```jsp
<%
for(int i = 0; i < 1000; i++) {
    if (i % 10 == 0) out.flush();
    out.print(i + " : 1234<br>");
}
%>
```

`out.flush()`  를 하면 에러가 나지 않는다.



**[ex07.jsp]**

웹 애플리케이션 배포



탐색기 - 

```
C:\apache-tomcat-8.5.73\bin\startup.bat
```

파일로 Tomcat 을 실행한다.

권한때문에 되지 않으니 넘어간다.



프로젝트 우클릭 - export - war file

Destination

```
C:\Users\Connor\Desktop\jspPro.war
```

export source files 체크

```
C:\apache-tomcat-8.5.73\webapps
```

폴더에 jspPro.war 파일을 저장하면 배포가 끝난다.

자동으로 jspPro 폴더가 생긴다.

매번 할 수가 없으므로 이클립스에서 플러그인을 사용해서 자동으로 배포한다.

AWS 때 배포해보자.




​    [ JSP페이지의 기본 내장 객체 9가지 ]
       1. `request`  javax.servlet.http.[HttpServletRequest] : 클라이언트의 요청 정보 저장
       2. `response`  javax.servlet.http.[HttpServletResponse] : 응답 정보 저장
       3. `pageContext`  javax.servlet.jsp.PageContext : JSP페이지에 대한 정보 저장
       4. `session`  javax.servlet.http.HttpSession : HTTP 세션 정보 저장
       5. `application`  javax.servlet.[ServletContext] : 웹 애플리케이션의 정보 저장
       6. `out` javax.servlet.jsp.[JspWriter] :  출력 스트림 - > 버퍼
       7. `config` javax.servlet.ServletConfig : JSP페이지에 대한 설정 정보를 저장
       8. `page`  java.lang.Object  : JSP페이지를 구현한 자바 클래스 인스턴스
       9. `exception`  java.lang.Throwable : 예외 객체 , 에러 페이지에서만 사용할 수 있다.    



- `request`
- `response`
- `out`



- `application` application 이 session 보다 범위가 더 크다.
- `session` 해당접속



- `pageContext` JSP 페이지에 대한 정보 저장.
  - JSP 페이지에 대한 기본객체도 얻어올 수 있다.
  - 속성 처리 가능
  - 페이지의 흐름 제어할 수 있다.
  - 에러 데이터를 구할 수 있다.
- `page` JSP 페이지를 구현한 자바클래스 인스턴스



- `config`



- `exception` 

## 함수

**[JSTL]**

**태그**

- `c:forEach` c:f 로 입력. `var` `items` 속성을 준다. `varStatus` 를 status 라고 지정하면 i 를 사용할 수 있다.
  - `begin` `end` `step` 을 줄 수도 있다.
- `c:if` c:i 로 입력. 

**status.**

- `current` var 와 같은 듯 하다.
- `index` i 를 0부터
- `count` i 를 1부터
- `first` for 문의 처음일 때 true. `c:if` 와 함께 사용
- `last` for 문의 마지막일 때 true. `c:if` 와 함께 사용
- `begin`
- `end`
- `step`  



**first & last**

```
first: 1
last: 3
```



```jsp
<c:forEach var="dto" items="${empList }" varStatus="i">
    <c:if test="${i.first }">first: ${i.count }</c:if> <br />
    <c:if test="${i.last }">last: ${i.count }</c:if> <br />
</c:forEach>
```



**$**

- `empty` 비어있으면 true
- `not empty` 비어있지 않으면 true





**[JSP 기본객체]**

**out.**

- `print`
- `println` `\r\n` 이 포함되지만 브라우저에서는  줄바꿈을 위해 `<br>` 태그가 필요하므로 줄바꿈이 되지 않는다. `print` + `newLine`
- `newLine()` `\r\n` 줄바꿈이 역시 되지 않는다.
- `getBufferSize()` 
- `getRemaining`
- `isAutoFlush` 

**request.**

- `setAttribute("속성명", 속성값)`
- `getAttribute("속성명")`

**pageContext.**

- `getRequest` ServletRequest 로 반환. request 의 타입은 `HttpServletRequest` 타입이 다르다. Http 가 자식인 듯.
- `getResponse` response
- `getSession` session
- `getServletContext` application
- `getServletConfig` config
- `getOut` out



```
public interface HttpServletRequest extends ServletRequest
```

Http 가 ServletRequest 의 자식이므로



```java
HttpServletRequest pc_request = (HttpServletRequest) pageContext.getRequest();
```

getRequest 를 Http 에 담으려면 다운캐스팅 해야한다.



```
true
```



```jsp
<%=request == pc_request %>
```





---



```
> 버퍼크기: 8192
> 남은버퍼: 7798
> Auto Flush: true
```



```jsp
> 버퍼크기: <%=out.getBufferSize()%> <br />
> 남은버퍼: <%=out.getRemaining()%> <br />
> Auto Flush: <%=out.isAutoFlush()%> <br />
```





**객체 가져오기**

```java
pageContext.getRequest(); // request
pageContext.getResponse(); // response
pageContext.getSession(); // session
pageContext.getServletContext(); // application
pageContext.getServletConfig(); // config
```

application 과 config 를 주의한다.

내일오전: 이론

내일오후: 게시판

시간이 남으면: jdbcPro\days03\board 쿼리







