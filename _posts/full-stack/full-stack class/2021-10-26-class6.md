---
title: 강의6
category: fullstack-class
---

## 10.26

복습

1-1. dept 테이블에 새로운 레코드 추가하는 쿼리 작성
     50, QC, SEOUL

> 같은 칼럼에 추가한다면 칼럼명을 생략할 수 있다.

3-1. emp테이블에서 ename에   's' 또는 'j' 문자를 대소문자를 구분하지 않고 포함하는 사원 정보 출력. 

```sql
WHERE regexp_like(upper(ename), '[SJ]');
WHERE regexp_like(ename, '[SJsj]'); -- 같은코드
WHERE regexp_like(upper(ename), '[SJ]', 'i'); -- 같은코드
```

>  `'i'`  대소문자를 구분하는 옵션

5-1. 앞 뒤 특정 문자 제거 
ㄱ. 앞 뒤 공백 제거
  SELECT '     msg     '       
  FROM dual;
  ㄴ. 앞 뒤 * 제거
  SELECT '*****msg*****'       
  FROM dual;

> trim 은 두 번째 인자가 없고 대신 trim(BOTH 제거할문자 FROM 전체문자) 의 형식으로 작성한다.
>
> BOTH 를 생략해도 된다.

7-1. 개강일로부터 오늘날짜까지의 수업일수 ? 
 개강일 : 2021.8.18

> 지난일수는 floor, 남은일수는 ceil 함수를 사용한다.

9-1. 아래 쿼리에 대한 결과를 적으세요 
select  sysdate
      , TRUNC(sysdate,'year')     --  
      , TRUNC(sysdate,'month')    --    
from dual; 

> 날짜는 99/99/99 형식이다.

10-1. emp테이블에서 ename 을 출력하는 데 앞뒤에 ***** 을 붙여서 출력

```
*****SMITH*****
*****ALLEN*****
*****WARD*****
*****JONES*****
*****MARTIN*****
*****BLAKE*****
*****CLARK*****
```

**concat**

```sql
SELECT concat(concat('*****', ename), '*****') AS name
FROM emp;
```

**pad**

```sql
SELECT lpad('*', 5, '*') || ename || lpad('*', 5, '*')
FROM emp;
```



11-1. emp 테이블에서 각 사원의 입사일을 기준으로 100일 후 날짜, 10일전 날짜, 1시간 후 날짜, 3개월 전 날짜 출력

SMITH	80/12/17	81/03/27	80/12/07	80/12/17	81/03/17	80/09/17
ALLEN	81/02/20	81/05/31	81/02/10	81/02/20	81/05/20	80/11/20
WARD	81/02/22	81/06/02	81/02/12	81/02/22	81/05/22	80/11/22

> 예약어, 괄호, 숫자, 공백을 ALIAS 할 때는 큰 따옴표가 필요하다.
>
> 큰 따옴표에 넣으면 대소문자를 구분해 칼럼명을 넣을 수 있다.

15-1. TO_CHAR( ,  'format') 함수에서 'format'에 사용되는 기호를 적으세요.
  ㄱ. 년도 : Y, YY, YYY, YYYY
  ㄴ. 월 :  MM
  ㄷ. 월의 일 : DD 
  주의 일 :  D
  년의 일 :  DDD
  ㄹ. 요일 :  DY, DAY
  ㅁ. 월의 주차 : W 
  년의 주차 :  WW
  ㅂ. 시간/24시간 : HH, HH24
  ㅅ. 분 : MI
  ㅇ. 초 : SS
  ㅈ. 자정에서 지난 초 : 
  ㅊ. 오전/오후 : AM/PM

17-1. insa 테이블에서 남자사원만 부서별로 정렬해서 출력하는 쿼리를 작성하세요.

> substr() 함수를 숫자와 비교할 수 있다.
>
>  주민번호 뒷자리의 첫 숫자는 남성은 홀수번, 여성은 짝수번이다.

틀린코딩

```sql
WHERE substr(ssn, 8, 1) = 1
```

맞는코딩

```sql
WHERE mod(substr(ssn, 8, 1), 2) = 1
```

전체코드

```sql
SELECT *
FROM insa
WHERE mod(substr(ssn, 8, 1), 2) = 1
ORDER BY buseo;
```

18-1. insa 테이블에서 전화번호가 있으면 '-'을 제거하고 전화번호를 출력하고, 없으면 '전화번호없음'을 출력
[실행결과]
NAME    CITY TEL
홍길남	경기	01199997575
이영숙	전남	01752145282
김인수	서울	전화번호없음
김말자	서울	01152487789
우재옥	서울	01045632587

```sql
SELECT name
	, city
	, nvl(replace(tel, '-'), '전화번호없음') AS tel
FROM insa;
```

> null 에 replace 를 써도 에러가나지 않는다.

20-3. 내림(절삭)(   십의 자리에서 자리에서 절삭  )
   SELECT 123454.6789 
   FROM dual;

```sql
   SELECT trunc(123454.6789, -2)
   FROM dual;
```

> 10 의자리에서 버린다면 trunc(n, -2) 가 맞다.

---

공부: to_char 의 세번째인자에 대해 찾아보기

**문제**

emp 테이블에서 평균 pay 보다 같거나 크면 'good' 출력, 작으면 'bad' 출력

```
ENAME	PAY		OVERPAY
------------------------
SMITH	800		bad
ALLEN	1900	bad
WARD	1750	bad
JONES	2975	good
MARTIN	2650	good
BLAKE	2850	good
CLARK	2450	good
KING	5000	good
TURNER	1500	bad
:
:
```



```sql
SELECT ename, sal + nvl(comm, 0) AS pay
    , CASE 
        WHEN (SELECT avg(sal + nvl(comm, 0)) FROM emp) < sal + nvl(comm, 0)
            THEN 'good' 
        ELSE 'bad'
    END AS overpay
FROM emp;
```

**인라인뷰**

```sql
SELECT ename, pay
    , CASE
        WHEN pay > avgpay
            THEN 'Good'
        ELSE 'Bad'
    END AS overpay
FROM (
    SELECT ename, sal + nvl(comm, 0) AS pay
        , (SELECT avg(sal + nvl(comm, 0)) FROM emp)AS avgpay
    FROM emp);
```

> CASE WHEN THEN 절은 AS 를 END 뒤에 쓴다.

### 복습

UNION 으로도 풀 수 있다.

```sql
SELECT ename, sal + NVL(comm, 0) PAY
      , ( SELECT  AVG( sal + NVL(comm, 0) ) AVGPAY FROM emp ) AVGPAY
      , 'GOOD'
FROM emp
WHERE sal + NVL(comm, 0) >= ( SELECT  AVG( sal + NVL(comm, 0) ) AVGPAY FROM emp )
UNION
SELECT ename, sal + NVL(comm, 0) PAY
      , ( SELECT  AVG( sal + NVL(comm, 0) ) AVGPAY FROM emp ) AVGPAY
      , 'BAD'
FROM emp
WHERE sal + NVL(comm, 0) < ( SELECT  AVG( sal + NVL(comm, 0) ) AVGPAY FROM emp );
```



**문제**

emp 테이블에서 사원이 속해있는 부서번호만 출력

```
DEPTNO
------
30
20
10
```

```sql
SELECT DISTINCT deptno
FROM emp;
```

**문제**

emp 에서 각 사원의 입사일자를 기준으로 10년 5개월 20일째 되는날은?

```
ENAME	HIREDATE	D_DAY
-----------------------------
SMITH	80/12/17	91/06/06
ALLEN	81/02/20	91/08/09
WARD	81/02/22	91/08/11
JONES	81/04/02	91/09/22
MARTIN	81/09/28	92/03/19
```



```sql
SELECT ename, hiredate,
    add_months(hiredate, 10*12 + 5) + 20 AS d_day
FROM emp;
```



**오후수업**

RR/YY 차이점 이해

**TO_DATE**

`to_date(문자, [형식], [NLS파라미터])`

CHAR, VARCHAR2, NCHAR, NVARCHAR2 데이터타입을 DATE 데이터타입으로 변환한다.



```
TO_DATE
--------
21/11/06
```

```sql
SELECT to_date('2022.2.14') - 100
    , to_date('2022/2/14') - 100
    , to_date('2022-2-14') - 100
    , to_date('20220214') - 100
FROM dual;
```

**to_char**

```
SYSDATE			DL					DS				한글
------------------------------------------------------------------------
21/10/26	2021년 10월 26일 화요일	2021/10/26	2021년 10일 26일 화요일
```

```sql
SELECT sysdate 
    , to_char(sysdate, 'DL') AS DL
    , to_char(sysdate, 'DS') AS DS
    , to_char(sysdate, 'YYYY"년" MM"일" DD"일" DAY') AS 한글
FROM dual;
```

`DL` Date Format Long

`DS` Date Format Short

`TS` 오후 2:55:46

**to_date**

```
21/12/24
```



```sql
SELECT to_date('2021년12월24일 ', 'YYYY"년"MM"월"DD"일"')
FROM dual;
```



**일부문자를 날짜형식으로**

```
21/10/01	21/09/01	21/10/23
```



```sql
SELECT to_date('2021', 'YYYY')
    , to_date('09', 'MM')
    , to_date('23', 'DD')
FROM dual;
```



**[특정형식으로 날짜출력]**

**커스텀**

```
2021년 10월 26일 (화요일) 오후 14:49:24
```

```sql
SELECT to_char(sysdate, 'YYYY"년" MM"월" DD"일" (DAY) AM HH24:MI:SS')
FROM dual;
```



```
2021년 10월 26일 (화요일) 오후 2:57:36
```

**TS**

```sql
SELECT to_char(sysdate, 'YYYY"년" MM"월" DD"일" (DAY) TS') AS today
FROM dual;
```

**DL TS**

```
2021년 10월 26일 화요일 오후 2:57:16
```



```sql
SELECT to_char(sysdate, 'DL TS') AS today
FROM dual;
```

**주민번호로부터 생일이 지났는지 확인**

```
NAME	SSN			SIGN
--------------------------
홍길동	771212-1022432	-1
이순신	801007-1544236	1
이순애	770922-2312547	1
김정훈	790304-1788896	1
한석봉	811112-1566789	-1
이기자	780505-2978541	1
:
:
```



```sql
SELECT name, ssn
    , sign(sysdate - to_date(substr(ssn, 3, 4), 'MMDD')) AS sign
FROM insa;
```

> 고유값 (PRIMARY KEY) 을 WHERE 에 사용해서 UPDATE 하는 습관을 가진다.

```
:
:
김싱식	800715-1313131	생일이 지났어요.
김영길	801216-1898752	생일이 지나지 않았어요.
김영년	821011-2362514	생일이 지났어요.
김인수	731211-1214576	생일이 지나지 않았어요.
김정훈	790304-1788896	생일이 지났어요.
김종서	751010-1122233	생일이 지났어요.
나윤균	810810-1552147	생일이 지났어요.
문길수	721217-1951357	생일이 지나지 않았어요.
박문수	780710-1985632	생일이 지났어요.
:
:
```

> 오늘이 생일이라면 생일이 지났다고 표시된다.

```sql
SELECT name, ssn
    , '생일이 지났어요.' AS birthday
FROM insa
WHERE sysdate > to_date(substr(ssn, 3, 4), 'MMDD')
UNION
SELECT name, ssn
    , '생일이 지나지 않았어요.'
FROM insa
WHERE sysdate < to_date(substr(ssn, 3, 4), 'MMDD');
```



**마지막날짜 숫자로 반환**

```
LAST_DAY
--------
29
```

2020년 2월의 마지막 날은 29일이다.

```sql
SELECT extract(day FROM last_day(to_date('2020.2', 'YYYY.MM'))) AS last_day
FROM dual;
```

**문자 입력받기**

```sql
SELECT extract(day FROM last_day(to_date(:yearmonth, 'YYYY.MM'))) AS last_day
FROM dual;
```

`:바인딩` 

**기타함수**

- `hextoraw()` 16진수 문자열 -> 2진수 문자열 변환
- `convert()` 다른국가 언어형식으로 변환
- `nullif(expr1, expr2)` 두 개의 값을 비교 -> null 또는 사용되어진 두 값 중 하나를 리턴하는 함수
  같으면 null 다르면 o1 을 반환한다.
- `coalesce(expr...)` 나열해 놓은 값을 순차적으로 체크하여 NULL 이 아닌 값을 리턴하는 함수



**COALESCE**

```
ENAME	PAY
------------------------------
SMITH	800		800		800
ALLEN	1900	1900	1900
WARD	1750	1750	1750
JONES	2975	2975	2975
MARTIN	2650	2650	2650
BLAKE	2850	2850	2850
CLARK	2450	2450	2450
KING	5000	5000	5000
TURNER	1500	1500	1500
JAMES	950		950		950
FORD	3000	3000	3000
MILLER	1300	1300	1300
```

```sql
SELECT ename
    , sal + nvl(comm, 0) AS pay
    , nvl2(comm, sal + comm, sal) AS pay
    , coalesce(sal+comm, sal, 0) AS pay
FROM emp;
```

**[DECODE]**

@@@매우중요

1. 프로그램 언어의 IF 문과 같다. -> PL/SQL 안에서 사용하기 위해서 만들어진 오라클 함수
2. FROM 절에서만 사용할 수 없다.
3. 비교연산중에서 등호 ( = ) 연산만 가능하다.
4. `DECODE()` 함수의 확장된 함수가 `CASE()` 함수이다.

자바

```java
if (A == B) {
    return C;
}
```

디코드

```sql
DECODE(A, B, C)
```

A 와 B 가 같으면 이 함수는 C 를 리턴한다.

자바

```java
if (A == B) {
    return X;
} else if (A == C) {
    return Y;
} else {
    return Z;
}
```

디코드

```sql
DECODE(A, B, X, C, Y, Z)
```

자바

```java
if (A == B) {
    return X;
} else {
    return Z;
}
```

디코드

```sql
DECODE(A, B, X, Z)
```

**문제**

insa 테이블에서 ssn 을 가지고 생일이 지났는지 여부 1, 0, -1

**생일여부 출력**

```
홍길동	771026-1022432	오늘이 생일입니다.
이순신	801007-1544236	생일이 지났습니다.
이순애	770922-2312547	생일이 지났습니다.
김정훈	790304-1788896	생일이 지났습니다.
한석봉	811112-1566789	생일이 지나지 않았습니다.
이기자	780505-2978541	생일이 지났습니다.
:
:
```



```sql
SELECT name, ssn
    , decode(sign(trunc(sysdate) - to_date(substr(ssn, 3, 4), 'MMDD'))
    , 0, '오늘이 생일입니다.' 
    , 1,  '생일이 지났습니다.'
    , -1, '생일이 지나지 않았습니다.') AS birthday
FROM insa;
```

**성별확인**

```
NAME	SSN			GENDER
----------------------------
홍길동	771026-1022432	남자
이순신	801007-1544236	남자
이순애	770922-2312547	여자
김정훈	790304-1788896	남자
한석봉	811112-1566789	남자
이기자	780505-2978541	여자
장인철	780506-1625148	남자
:
:
```



```sql
SELECT name, ssn
    , decode(mod(substr(ssn, 8, 1), 2)
    , 1, '남자'
    , '여자') AS gender
FROM insa;
```

**문제**

emp 테이블에서 10번 부서원들은 급여 10% 인상, 20번 부서원들은 급여 20% 인상, 그 외 부서원 (30, 40) 급여 5% 인상 (DECODE() 함수사용)

```
ENAME	SAL	  pay	COMM  DEPTNO 인상금액
KING	5000		5000	10	5500
CLARK	2450		2450	10	2695
MILLER	1300		1300	10	1430
FORD	3000		3000	20	3600
SMITH	800			800		20	960
JONES	2975		2975	20	3570
JAMES	950			950		30	997.5
TURNER	1500	0	1500	30	1575
:
:
```



```sql
SELECT ename, sal, comm, sal + nvl(comm, 0) AS pay, deptno
    , decode(deptno
    , 10, 1.1
    , 20, 1.2
    , 1.05) * (sal + nvl(comm, 0)) AS 인상금액
FROM emp
ORDER BY deptno;
```

